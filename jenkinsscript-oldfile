pipeline {
    agent any
    tools{
        maven "maven"
    }
    stages {
        stage('SCM checkout') {
            steps {
               checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/NareshVanka21/jenkins-ci-cd.git']])
            }
        }
        stage("build process"){
            steps{
                script{
                bat "mvn clean install"
                }
            }
        }
        stage("build image"){
            steps{
            script {
                bat 'docker build -t nareshvanka/spring-jenkins-cicd:10.0 .'
            }
            }
        }
         stage("Deploy Image to Hub"){
            steps{
               withCredentials([
                    usernamePassword(
                        credentialsId: 'db-creds',
                        usernameVariable: 'DOCKER_USER',
                        passwordVariable: 'DOCKER_PASS'
                    )
                ]) {
                    bat '''
                        echo %DOCKER_PASS% | docker login -u %DOCKER_USER% --password-stdin
                    '''
                    bat 'docker push nareshvanka/spring-jenkins-cicd:10.0'
}
            }
        }
    }
}
